<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Single Game Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 900px;
        margin: auto;
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
      }
      .game-container {
        border: 2px solid #333;
        padding: 15px;
        margin-bottom: 30px;
      }
      .game-header {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 10px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: center;
      }
      input[type="text"] {
        width: 60px;
      }
      button {
        padding: 8px 12px;
        font-size: 14px;
        cursor: pointer;
        margin: 3px;
      }
      .result {
        font-size: 16px;
        font-weight: bold;
        margin-top: 10px;
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>101MATİK</h1>

    <button id="resetGameBtn">Reset Game</button>
    <button id="exportPdfBtn">Export Result as PDF</button>
    <button id="shareWhatsappBtn">Share to WhatsApp</button>

    <div id="gameContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
      const gameId = "game1";
      let gameData = {};

      document
        .getElementById("exportPdfBtn")
        .addEventListener("click", exportResultToPdf);
      document
        .getElementById("resetGameBtn")
        .addEventListener("click", resetGame);
      document
        .getElementById("shareWhatsappBtn")
        .addEventListener("click", shareToWhatsapp);

      function initialize() {
        const container = document.getElementById("gameContainer");
        container.innerHTML = "";

        const savedData = localStorage.getItem("singleGameData");

        if (savedData) {
          gameData = JSON.parse(savedData);
        } else {
          initEmptyGameData();
        }

        renderGame();
      }

      function initEmptyGameData() {
        gameData = {
          prizeTeam1: 0,
          prizeTeam2: 0,
          prizeCount1: 0,
          prizeCount2: 0,
          scoresTeam1: Array(21).fill(0),
          scoresTeam2: Array(21).fill(0),
        };
      }

      function renderGame() {
        const container = document.getElementById("gameContainer");
        container.innerHTML = `
    <div class="game-container" id="${gameId}">
      <div class="game-header">Game 1</div>
      <table>
        <thead>
          <tr>
            <th>Round</th>
            <th>Yusuf-Yüksel Points</th>
            <th>Ahmet-Mete Points</th>
          </tr>
        </thead>
        <tbody>
          ${[...Array(21).keys()]
            .map(
              (i) => `
            <tr>
              <td>${i + 1}</td>
              <td><input type="text" value="${
                gameData.scoresTeam1[i]
              }" id="${gameId}_team1_${i + 1}" oninput="updateGameData()"></td>
              <td><input type="text" value="${
                gameData.scoresTeam2[i]
              }" id="${gameId}_team2_${i + 1}" oninput="updateGameData()"></td>
            </tr>`
            )
            .join("")}
        </tbody>
      </table>
      <button onclick="applyPrize(1)">Prize to Yusuf-Yüksel (-100)</button>
      <button onclick="applyPrize(2)">Prize to Ahmet-Mete (-100)</button>
      <button onclick="calculateResult()">Calculate Winner</button>
      <button onclick="toggleResult()">Show/Hide Scores</button>
      <div class="result" id="${gameId}_result" style="display:none;">Results here.</div>
      <table>
        <thead>
          <tr>
            <th>Team</th>
            <th>Prizes Count</th>
            <th>Total Points Reduced</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Yusuf-Yüksel</td>
            <td id="${gameId}_prizeCount1">${gameData.prizeCount1}</td>
            <td id="${gameId}_prizePoints1">${gameData.prizeTeam1}</td>
          </tr>
          <tr>
            <td>Ahmet-Mete</td>
            <td id="${gameId}_prizeCount2">${gameData.prizeCount2}</td>
            <td id="${gameId}_prizePoints2">${gameData.prizeTeam2}</td>
          </tr>
        </tbody>
      </table>
    </div>
  `;
      }

      function updateGameData() {
        for (let i = 1; i <= 21; i++) {
          let val1 = document.getElementById(`${gameId}_team1_${i}`).value;
          let val2 = document.getElementById(`${gameId}_team2_${i}`).value;

          gameData.scoresTeam1[i - 1] = Number(val1) || 0;
          gameData.scoresTeam2[i - 1] = Number(val2) || 0;
        }
        saveToLocal();
      }

      function applyPrize(team) {
        if (team === 1) {
          gameData.prizeTeam1 += 100;
          gameData.prizeCount1 += 1;
        } else {
          gameData.prizeTeam2 += 100;
          gameData.prizeCount2 += 1;
        }
        updatePrizeTable();
        saveToLocal();
      }

      function updatePrizeTable() {
        document.getElementById(`${gameId}_prizeCount1`).innerText =
          gameData.prizeCount1;
        document.getElementById(`${gameId}_prizePoints1`).innerText =
          gameData.prizeTeam1;
        document.getElementById(`${gameId}_prizeCount2`).innerText =
          gameData.prizeCount2;
        document.getElementById(`${gameId}_prizePoints2`).innerText =
          gameData.prizeTeam2;
      }

      function calculateResult() {
        let totalTeam1 = gameData.scoresTeam1.reduce((a, b) => a + b, 0);
        let totalTeam2 = gameData.scoresTeam2.reduce((a, b) => a + b, 0);

        let adj1 = totalTeam1 - gameData.prizeTeam1;
        let adj2 = totalTeam2 - gameData.prizeTeam2;

        let winner = "";
        if (adj1 < adj2) winner = "Yusuf-Yüksel win";
        else if (adj2 < adj1) winner = "Ahmet-Mete win";
        else winner = "It's a tie!";

        const resDiv = document.getElementById(`${gameId}_result`);
        resDiv.innerHTML = `
    Yusuf-Yüksel: ${adj1} (Prizes: ${gameData.prizeTeam1})<br>
    Ahmet-Mete: ${adj2} (Prizes: ${gameData.prizeTeam2})<br>
    <strong>${winner}</strong>
  `;
        resDiv.style.display = "block";

        saveToLocal();
      }

      function toggleResult() {
        const resDiv = document.getElementById(`${gameId}_result`);
        resDiv.style.display =
          resDiv.style.display === "none" ? "block" : "none";
      }

      function resetGame() {
        if (confirm("Are you sure you want to reset the game?")) {
          initEmptyGameData();
          renderGame();
          saveToLocal();
        }
      }

      function saveToLocal() {
        localStorage.setItem("singleGameData", JSON.stringify(gameData));
      }

      function exportResultToPdf() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        let totalTeam1 = gameData.scoresTeam1.reduce((a, b) => a + b, 0);
        let totalTeam2 = gameData.scoresTeam2.reduce((a, b) => a + b, 0);
        let adj1 = totalTeam1 - gameData.prizeTeam1;
        let adj2 = totalTeam2 - gameData.prizeTeam2;

        let winner = "";
        if (adj1 < adj2) winner = "Yusuf-Yüksel win";
        else if (adj2 < adj1) winner = "Ahmet-Mete win";
        else winner = "It's a tie!";

        doc.setFontSize(14);
        doc.text("Single Game Result", 10, 10);

        let y = 20;
        doc.setFontSize(12);
        for (let i = 0; i < 21; i++) {
          const roundText = `Round ${i + 1}: Yusuf-Yüksel = ${
            gameData.scoresTeam1[i]
          }, Ahmet-Mete = ${gameData.scoresTeam2[i]}`;
          doc.text(roundText, 10, y);
          y += 7;
          if (y > 280) {
            doc.addPage();
            y = 20;
          }
        }

        y += 5;
        doc.text(
          `Total Yusuf-Yüksel: ${totalTeam1} (After Prizes: ${adj1})`,
          10,
          y
        );
        y += 7;
        doc.text(
          `Total Ahmet-Mete: ${totalTeam2} (After Prizes: ${adj2})`,
          10,
          y
        );
        y += 7;
        doc.text(`Result: ${winner}`, 10, y);

        doc.save("single_game_result.pdf");
      }

      function shareToWhatsapp() {
        let totalTeam1 = gameData.scoresTeam1.reduce((a, b) => a + b, 0);
        let totalTeam2 = gameData.scoresTeam2.reduce((a, b) => a + b, 0);
        let adj1 = totalTeam1 - gameData.prizeTeam1;
        let adj2 = totalTeam2 - gameData.prizeTeam2;

        let winner = "";
        if (adj1 < adj2) winner = "Yusuf-Yüksel win";
        else if (adj2 < adj1) winner = "Ahmet-Mete win";
        else winner = "It's a tie!";

        let message = "🏓 Game Results:\n\n";

        for (let i = 0; i < 21; i++) {
          message += `Round ${i + 1}: Yusuf-Yüksel = ${
            gameData.scoresTeam1[i]
          }, Ahmet-Mete = ${gameData.scoresTeam2[i]}\n`;
        }

        message += `\nTotal Yusuf-Yüksel: ${totalTeam1} (After Prizes: ${adj1})\n`;
        message += `Total Ahmet-Mete: ${totalTeam2} (After Prizes: ${adj2})\n`;
        message += `\n🏆 ${winner}`;

        const encoded = encodeURIComponent(message);
        const whatsappUrl = `https://wa.me/?text=${encoded}`;

        window.open(whatsappUrl, "_blank");
      }

      initialize();
    </script>
  </body>
</html>
